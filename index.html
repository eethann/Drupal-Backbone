<!DOCTYPE html>  <html> <head>   <title>drupalbackbone.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               drupalbackbone.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>A Child of <a href="http://documentcloud.github.com/backbone">Backbone.JS</a> with Drupal Services defaults</p>

<ul>
<li>TODO Add .TaxonomyCollection with support for taxonomy listings.</li>
<li>TODO Add .SearchCollection with support for search results.</li>
<li>TODO Add configurable endpoint path, loaded via Drupal Behaviors
(will remove hard dependency on backbone_base feature)</li>
<li>TODO Add .FieldViewCollection for working with field views.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Attached to page via Drupal behaviors, for reasons
of both perperness and so we can use Drupal JS setings.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Drupal</span><span class="p">.</span><span class="nx">behaviors</span><span class="p">.</span><span class="nx">backbone</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">attach</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h2>Drupal.Backbone</h2>

<p>Starts with the Drupal.Backbone Constructor, currently a no-op</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">Drupal</span><span class="p">.</span><span class="nx">Backbone</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h2>Base objects for Drupal Backbone implementation.</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h3>Drupal.Backbone.Model</h3>

<p>Extend the Model object with default Drupal Services settings and methods.
These are defaults for interfacing with all Service module's providers.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">Drupal</span><span class="p">.</span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Use the Drupal Services REST format for nodes, /endpoint/{{nid}}.json.
We don't include the collection stuff here, since Drupal collections are
indpendent of their objects.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">url</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Modified from Backbone.js to ignore collection and add ".format" extension.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="kd">var</span> <span class="nx">base</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">urlRoot</span> <span class="o">||</span> <span class="nx">urlError</span><span class="p">();</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isNew</span><span class="p">())</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">base</span><span class="p">;</span> <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Add .json for format here.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">return</span> <span class="nx">base</span> <span class="o">+</span> <span class="p">(</span><span class="nx">base</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">base</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;/&#39;</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.json&quot;</span><span class="p">;</span>
          <span class="p">}</span>
      <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h3>Drupal.Backbone.Collection</h3>

<p>Currently just sets the endpoint for all collections.</p>

<p>TODO fix scoping issue that causes params to bleed between children of this object.
 e.g. if you have two NodeViewCollections, setting limit on one sets on both.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">Drupal</span><span class="p">.</span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Base endpoint, used to create full url for each collection.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">restEndpoint</span><span class="o">:</span> <span class="s2">&quot;/backbone/rest&quot;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Drupal collections are stateful, we store params in the collection.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">params</span><span class="o">:</span> <span class="p">{},</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Setter for individual params, called as setParam('name','value').</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">setParam</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">paramName</span><span class="p">,</span> <span class="nx">paramValue</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">params</span><span class="p">[</span><span class="nx">paramName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">paramValue</span><span class="p">;</span>
        <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Setter for multiple params, passed as object with key/value pairs.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">setParams</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;Object&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">params</span><span class="p">,</span>
              <span class="nx">params</span>
            <span class="p">);</span>
          <span class="p">}</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Getter. Currently just returns param object property.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">getParams</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Fetch method passes params as data in AJAX call.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">fetch</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Allow options.data to override any params.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">_</span><span class="p">.</span><span class="nx">defaults</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">getParams</span><span class="p">());</span>
          <span class="p">}</span> 
          <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getParams</span><span class="p">())</span> <span class="p">{</span>
            <span class="nx">options</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getParams</span><span class="p">();</span>
          <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Call Super fetch function with options array including any collection params.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">fetch</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h3>Drupal.Backbone.View</h3>

<p>Currently just a no-op, for later use once we get to Backbone views integration.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">Drupal</span><span class="p">.</span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({});</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <h2>Drupal.Backbone Models</h2>

<p>Drupal-specific models. Currently just nodes, but terms and files could follow.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <h3>Drupal.Backbone.NodeModel</h3>

<p>Node-specific settings for Drupal Services' node resource.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">Drupal</span><span class="p">.</span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">NodeModel</span> <span class="o">=</span> <span class="nx">Drupal</span><span class="p">.</span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">urlRoot</span><span class="o">:</span> <span class="s2">&quot;/backbone/rest/node&quot;</span><span class="p">,</span>
        <span class="nx">idAttribute</span><span class="o">:</span> <span class="s2">&quot;nid&quot;</span><span class="p">,</span> </pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Override toJSON function to nest all attributes in a { node: ... } key
to make this work with the Services module implementation of node PUSH/PUT.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">toJSON</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">node</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">)</span>
          <span class="p">};</span>
          <span class="k">return</span> <span class="nx">data</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <h2>Drupal Backbone Collections</h2>

<p>Specific collections for Drupal listing types.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <h3>Drupal.Backbone.NodeIndexCollection</h3>

<p>Create collection for Node resource's index interface.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">Drupal</span><span class="p">.</span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">NodeIndexCollection</span> <span class="o">=</span> <span class="nx">Drupal</span><span class="p">.</span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">model</span><span class="o">:</span> <span class="nx">Drupal</span><span class="p">.</span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">NodeModel</span><span class="p">,</span>
        <span class="nx">url</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">restEndpoint</span> <span class="o">+</span> <span class="s2">&quot;/node.json&quot;</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">});</span>
  </pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <h3>Drupal.Backbone.NodeViewCollection</h3>

<p>Create collection for Views resource's index interface.
Note that this is just for views that use the "Content" display
for their nodes.  Field views will need to be handled differently.</p>

<p>May be worth considering if field views are really appropriate 
for backbone, since it deals with collections of model objects,
and field views do not fit that mode.</p>

<p>TODO require view name at initialization or fetch.
TODO create basic view collection, subclass node and field views.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">Drupal</span><span class="p">.</span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">NodeViewCollection</span> <span class="o">=</span> <span class="nx">Drupal</span><span class="p">.</span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">model</span><span class="o">:</span> <span class="nx">Drupal</span><span class="p">.</span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">NodeModel</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Name of Drupal view for this collection.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">viewName</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">url</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">restEndpoint</span> <span class="o">+</span> <span class="s2">&quot;/views/&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewName</span> <span class="o">+</span> <span class="s2">&quot;.json&quot;</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">};</span>

<span class="p">})(</span><span class="nx">jQuery</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 